{% extends "index.html" %}
{% block title %}{{ doc.ti.0 }} {% if doc.fo.0 %} | {{ doc.fo.0 }} {% endif %} {% if doc.db %} | {{ occ({'element': doc.db, separator: ' | '}) }} {% endif %} | {{ texts.BVS_TITLE }}{% endblock %}

{% block breadcrumb_last %}
    {%if doc.ti.0 is defined %}{{doc.ti.0|slice(0,90)}}{% else %}{{ doc.ti|slice(0,90)}}{% endif %}
{% endblock %}

{% block extrahead %}
    <meta name="citation_id" content="{{ doc.id }}" />
    <meta name="dc.identifier" content="{{ doc.id }}" />

    {% for title in doc.ti %}
        <meta name="dc.title" content="{{ title }}" />
    {% endfor %}

    {% if "a" in doc.nivel_tratamento %}
        <meta name="citation_title" content="{{ doc.ti.0 }}" />
    {% endif %}

    {% if doc.au is defined %}
        {% for author in doc.au %}
            <meta name="dc.contributor"  content="{{ author }}" />
            <meta name="citation_author" content="{{ author }}" />
        {% endfor %}
    {% endif %}

    {% if doc.ur is defined %}
        <meta name="citation_fulltext_html_url" content="{{ doc.ur.0 }}" />
    {% endif %}
    {% if doc.mh is defined %}
        {% for descriptor in doc.mh %}
            {% if '/' in descriptor %}
                <meta name="citation_keywords" content="{{ descriptor|substring_before('/') }}" />
            {% else %}
                <meta name="citation_keywords" content="{{ descriptor }}" />
            {% endif %}
        {% endfor %}
    {% endif %}

    {% if doc.book_title %}
        <meta name="citation_inbook_title" content="{{ doc.book_title }}" />
    {% endif %}

    {% if doc.type.0 == "article" %}
        <meta name="citation_journal_title" content="{{ doc.ta.0 }}" />
    {% endif %}

    {% if "-" in doc.pg.0 %}
        <meta name="citation_firstpage" content="{{ doc.pg.0|substring_before('-')|trim }}" />
        <meta name="citation_lastpage" content="{{ doc.pg.0|substring_after('-')|trim }}" />
    {% else %}
        <meta name="citation_firstpage" content="{{ doc.pg.0 }}" />
        <meta name="citation_lastpage" content="{{ doc.pg.0 }}" />
    {% endif %}

    <meta name="citation_language" content="{{ doc.la.0 }}" />
    <meta name="citation_publication_date" content="{{ doc.da|slice(0,4) }}" />
    <meta name="dc.date" content="{{ doc.da|slice(0,4) }}" />
{% endblock %}

{% block content %}

    <div class="row padding1">
        <!-- Centro -->
        <div class="col-md-9 d-print-block">
            <div class="doc-detail box4">
                <div class="titleArt">
                    <b>{% autoescape false %}{{ occ( {'element': doc.ti, separator: ' / '} ) }}{% endautoescape %}</b>
                </div>
                <div class="author">
                    {% if doc.au is defined %}
    			        {% for author in doc.au %}
    			            <a href='{{ constant("SEARCH_URL") }}?lang={{ lang }}&q=au:"{{ author }}"'>{{ author }}</a>{% if loop.last %}.{% else %};{% endif %}
    			        {% endfor %}
    			    {% endif %}
                </div>

                {% include custom_template("result-inc-source.html") %}

                {% if config.epistemonikos_token %}
                    <div id="epistemonikos_info">
                    </div>
                {% endif %}
            </div>

            {% if doc.ab or doc.mh %}
                <!-- abstract / subject box -->
                <div class="box4 d-print-flex-12">
                    {% set mark_ab_list = [] %}
                    {% set raw_ab_list = [] %}
                    {% set ab_active_lang = '' %}

                    {% for key in doc|keys %}
                        {% if 'mark_ab' in key %}
                            {% set mark_ab_list = mark_ab_list|merge({ (loop.index0): key}) %}
                        {% elseif 'ab_' in key %}
                            {% set raw_ab_list = raw_ab_list|merge({ (loop.index0): key}) %}
                        {% endif %}
                    {% endfor %}

                    {% if mark_ab_list %}
                        {% set ab_list = mark_ab_list %}
                    {% elseif raw_ab_list %}
                        {% set ab_list = raw_ab_list %}
                    {% endif %}

                    {% if ab_list %}
                        {% for ab_field in ab_list %}
                            {% set ab_lang = ab_field|split('_')|last %}
                            {% if ab_lang == lang %}
                                {% set ab_active_lang = ab_lang %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}

                    <div class="social">
                        <a href="https://www.facebook.com/sharer.php?u={{ current_url }}" target="_blank" class="mediaSocial fab fa-facebook-f"></a>
                        <a href="https://twitter.com/intent/tweet?text={{doc.ti.0}} {{ current_url }}" target="_blank" class="mediaSocial fab fa-twitter"></a>
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ current_url }}&title={{ doc.ti.0 }} - {{ texts.BVS_TITLE }}" target="_blank" class="mediaSocial fab fa-linkedin-in"></a>
                        <a href="https://api.whatsapp.com/send?text={{ doc.ti.0 }} - {{ texts.BVS_TITLE }} - {{ current_url }}" target="_blank" class="mediaSocial fab fa-whatsapp"></a>
                        <!-- <a href="#" target="_blank" class="mediaSocial fas fa-share-alt"></a> -->
                    </div>

                    {% if ab_list %}
                        <ul class="nav nav-tabs" id="tabResumo" role="tablist">
                            {% for ab_field in ab_list %}
                                {% set ab_lang = 'ab_' in ab_field ? ab_field|split('_')|last : doc.la[0] %}
                                {% set label_name = ab_lang != 'ab' ?  'LABEL_ABSTRACT_' ~ ab_lang|upper : 'LABEL_ABSTRACT' %}

                                <li class="nav-item">
    								<a class="nav-link {% if ab_active_lang %}{% if ab_lang == ab_active_lang %}active{% endif %}{% elseif loop.index == 1%}active{% endif %}" id="{{ ab_field }}-tab" data-toggle="tab" href="#{{ab_field}}" role="tab" aria-controls="{{ ab_field }}" aria-selected="true">
                                        {{ attribute(texts.RESULT, label_name) }}
                                    </a>
    							</li>
                            {% endfor %}
                        </ul>
                        <div class="tab-content" id="resumo">
                            {% for ab_field in ab_list %}
                                {% set ab_lang = 'ab_' in ab_field ? ab_field|split('_')|last : doc.la[0] %}
                                {% set label_name = ab_lang != 'ab' ?  'LABEL_ABSTRACT_' ~ ab_lang|upper : 'LABEL_ABSTRACT' %}

                                <div class="tab-pane fade show {% if ab_active_lang %}{% if ab_lang == ab_active_lang %}active{% endif %}{% elseif loop.index == 1%}active{% endif %}" id="{{ab_field}}" role="tabpanel" aria-labelledby="{{ ab_field }}-tab">
                                    <div class="d-none d-print-block">{{ attribute(texts.RESULT, label_name) }}</div>
                                    {{ attribute(doc, ab_field).0|raw }}
                                </div>
                            {% endfor %}
                        </div>
                    {% elseif doc.ab is defined %}
                        <ul class="nav nav-tabs" id="tabResumo" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="ab-tab" data-toggle="tab" href="#ab" role="tab" aria-controls="ab" aria-selected="true">
                                    {{ texts.RESULT.LABEL_ABSTRACT }}
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content" id="resumo">
                            <div class="tab-pane fade show active" id="ab" role="tabpanel" aria-labelledby="ab-tab">
        			            {% for abstract in doc.ab %}
        			                {{ abstract|raw }}{% if loop.last %}{% else %}<hr/>{% endif %}
        			            {% endfor %}
                            </div>
                        </div>
    			    {% endif %}

                    {% if doc.mh is defined  %}
                        <b>{{ texts.RESULT.LABEL_SUBJECT }}</b><br>
                        <!-- subject -->
                        <div class="tags{% if lang not in ['pt', 'es', 'en'] %}_disable_tooltip{% endif %}">
                            {% for subject in doc.mh %}
                                <a href='{{ constant("SEARCH_URL") }}?lang={{ lang }}&q=mh:"{{ subject|replace({'&amp;':'%26'})|raw }}"'  class="link1">{{ subject|raw }}</a>
                                {% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div> <!-- /box4 -->
            {% else %}
                <div class="social">
                    <a href="https://www.facebook.com/sharer.php?u={{ current_url }}" target="_blank" class="mediaSocial fab fa-facebook-f"></a>
                    <a href="https://twitter.com/intent/tweet?text={{doc.ti.0}} {{ current_url }}" target="_blank" class="mediaSocial fab fa-twitter"></a>
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ current_url }}&title={{ doc.ti.0 }} - {{ texts.BVS_TITLE }}" target="_blank" class="mediaSocial fab fa-linkedin-in"></a>
                    <a href="https://api.whatsapp.com/send?text={{ doc.ti.0 }} - {{ texts.BVS_TITLE }} - {{ current_url }}" target="_blank" class="mediaSocial fab fa-whatsapp"></a>
                    <!-- <a href="#" target="_blank" class="mediaSocial fas fa-share-alt"></a> -->
                </div>
            {% endif %}
        </div> <!-- /col-md-9 -->
        {% include custom_template('column-detail-actions.html') %}
    </div>

{% endblock %}

{% block footerscripts %}
    <script src="{{ constant("STATIC_URL") }}/js/add_collection.js"></script>

    {% if config.epistemonikos_token %}
        {% if 'LILACS' in doc.db or 'MEDLINE' in doc.db %}
        <script type="text/javascript">
            doc_id = '{% if "MEDLINE" in doc.db %}{{ doc.id|substring_after('-') }}{% else %}{{ doc.id }}{% endif %}';
            service_url = '{{ constant("SEARCH_URL") }}' + 'epistemonikos/' + LANG + '/' + doc_id;

            $("#epistemonikos_info" ).load(service_url);
        </script>
        {% endif %}
    {% endif %}

    {% if config.show_similar_docs == 'true' %}
        <script>
            var similar_url = '{{ constant("SEARCH_URL") }}' + 'similar/';
            var text_param = "{{ occ( {'element': doc.ti, separator: ' '} ) }}";
            {% if doc.mh %}
                text_param += "{{ occ( {'element': doc.mh, separator: ' '} ) }}";
            {% endif %}
            {% if doc.ab %}
                text_param += "{{ occ( {'element': doc.ab, separator: ' '} ) }}";
            {% endif %}
            // Send the data using post
            var posting = $.post( similar_url, { text: text_param, doc_id: '{{doc.id}}' } );

            // Put the results in a div
            posting.done(function( data ) {
              $('#similar-docs').empty().append(data);
            });
        </script>
    {% endif %}

    {% if 'MEDLINE' in doc.db %}
    <script>
        $('#pubmed_linkout').click(function (e) {
            e.preventDefault();
            var service_url = $(this).attr("href");
            $("#ModalPubmed").find('.modal-body').load(service_url);
        });
    </script>
    {% endif %}

{% endblock %}
