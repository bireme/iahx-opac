<!-- related resources -->
{% if doc.related_resource is defined  %}
    <div class="related_resource">
        <ul>

        {# Remove duplicates based on _w and _i fields #}
        {% set seen = [] %}
        {% set unique = [] %}
        {% for item in doc.related_resource %}
            {% set item_occ = item|json2array %}
            {% set item_dup_key = item_occ._w ~ '|' ~ item_occ._i %}
            {% if item_dup_key not in seen %}
                {% set seen = seen|merge([item_dup_key]) %}
                {% set unique = unique|merge([item_occ]) %}
            {% endif %}
        {% endfor %}

        {# Now iterate over unique items #}
        {% for rel_occ in unique %}
            {% set rel_type = rel_occ._i|upper %}
            <li>
                {% if rel_occ._t is defined %}
                    <strong>{{ attribute(texts.RESULT, rel_type)|default('') }}</strong>

                    {% if rel_occ._w is defined %}
                        <a href="{{ constant("SEARCH_URL") }}resource/{{ lang }}/{{ rel_occ._w }}">{{ rel_occ._t|substring_after('|') }}</a>
                    {% elseif rel_occ._6 is defined %}
                        <a href="{{ rel_occ._6 }}" target="_blank">{{ rel_occ._t|substring_after('|') }}</a>
                    {% else %}
                        {{ rel_occ._t|substring_after('|') }}
                    {% endif %}
                {% endif %}
            </li>
        {% endfor %}
        </ul>
    </div>
{% endif %}
